<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <title>Correcting Sampled NetFlow Data</title>
    <link rel="StyleSheet" href="css/al_module_netflow.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body style="margin-left: 2%; margin-right: 2%" onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="_al_module_netflow_splash.html"> NetFlow Data Collection</a> &gt; <a class="WebWorks_Breadcrumb_Link" href="al_module_netflow.05.01.html">Collecting NetFlow Data</a> &gt; Correcting Sampled NetFlow Data</div>
    <hr align="left" />
    <blockquote>
      <div class="h1"><a name="933933">Correcting Sampled NetFlow Data</a></div>
      <div class="body"><a name="933937">AppResponse gives you the option to correct sampled NetFlow v9 data. When sampling correction is enabled, AppResponse scales the traffic observed for each flow by the sampling rate of the reporting interface. Data for both interfaces and groups (BGs, IP conversations, and so on) are corrected.</a></div>
      <div class="body"><a name="933944">AppResponse obtains sampling rates from a v9 options template. You must configure your NetFlow devices to send the sampling options template to AppResponse (as described in </a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.08.html#933976', '');" title="Correcting Sampled NetFlow Data">Configuration</a></span>). Until the options template is received, AppResponse discards any data it receives from the corresponding device.</div>
      <div class="bodyIntro"><a name="1001205">Note the following:</a></div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933958">AppResponse cannot perform de-duplication on sampled NetFlow data. If you are using sampled data, avoid duplicate traffic by following the configuration details given in </a><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.03.html#933434', '');" title="Configuring NetFlow on Network Devices">Table&nbsp;1&nbsp;</a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.03.html#933434', '');" title="Configuring NetFlow on Network Devices">NetFlow Configuration Options</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="1001147">If you want to use sampled NetFlow data in AppResponse, Riverbed recommends that you disable the “Collect and merge data with Monitoring Interface(s) groups/drilldowns” option (Administration&nbsp;&gt; System&nbsp;&gt; Advanced&nbsp;&gt; NetFlow&nbsp;Data&nbsp;Collection&nbsp;Options). This ensures that the sampled NetFlow data is considered for interface metrics only.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="listBulletCont"><a name="1001279">Sampled NetFlow data does not include enough information to calculate accurate metrics for Business Groups, Applications, IPs, or other groups that include traffic flows seen on multiple NetFlow-enabled devices. If the “Collect and merge” option is enabled with sampled Netflow data, these metrics will be too high. (Because the traffic-flow sampling on each device is different, there is no reliable way to identify identical flows and eliminate duplicates.) </a></div>
      <div class="listBulletCont"><a name="1001281">If you want to enable the “Collect and merge” option, you should configure your devices to send</a><span class="italic"> unsampled NetFlow data only </span>to the appliance.</div>
      <div class="h2NoBreak"><a name="933963">Requirements</a></div>
      <div class="bodyIntro"><a name="933964">NetFlow sampling correction has the following requirements:</a></div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933965">One or more devices must be configured for Random Sampled NetFlow.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933966">The NetFlow export format must be version 9.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933967">Every device that uses NetFlow sampling must be configured as described in </a><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.03.html#933434', '');" title="Configuring NetFlow on Network Devices">Table&nbsp;1&nbsp;</a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.03.html#933434', '');" title="Configuring NetFlow on Network Devices">NetFlow Configuration Options</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933971">Disable the “Collect and merge data with Monitoring Interface(s) groups/drilldowns” option (see </a><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.04.html#933520', '');" title="Configuring NetFlow Collection on an AppResponse Appliance">Table&nbsp;2&nbsp;</a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.04.html#933520', '');" title="Configuring NetFlow Collection on an AppResponse Appliance">NetFlow Data Collection Options in Administration &gt; System Web UI</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="h2NoBreak"><a name="933976">Configuration</a></div>
      <div class="bodyIntro"><a name="933980">To have AppResponse perform correction of sampled data:</a></div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933983">Enable sampling correction through the Web UI (see </a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.04.html', '');" title="Configuring NetFlow Collection on an AppResponse Appliance">Configuring NetFlow Collection on an AppResponse Appliance</a></span> for details).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="listBullet_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="listBullet_inner" style="width: 16.128pt; white-space: nowrap">
                <span style="color: #000000; font-family: Arial; font-size: 7.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">
                  <img src="HTML_Bullet.gif" alt="*" border="0" width="5" height="7" />
                </span>
              </div>
            </td>
            <td width="100%">
              <div class="listBullet_inner"><a name="933988">Configure NetFlow devices to support sampling correction (</a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.08.html#933990', '');" title="Correcting Sampled NetFlow Data">Procedure&nbsp;6</a></span>).</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="procCaption" onclick="WebWorks_ToggleDIV(WebWorksRootPath, &quot;wwdd933990&quot;);">
        <script type="text/javascript" language="JavaScript1.2">WebWorks_WriteArrow(WebWorksRootPath, "wwdd933990", false);</script>Procedure&nbsp;6    <a name="933990">Setting Up NetFlow Devices for Sampling Correction</a></div>
      <script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVOpen("wwdd933990", false);</script>
      <div class="procNote">
        <span class="bold">Note—</span><a name="933991">This procedure assumes NetFlow data collection has been previously configured, as described in </a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.02.html', '');" title="Setting Up NetFlow Data Collection">Setting Up NetFlow Data Collection</a></span>.</div>
      <div class="procStep_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="procStep_inner" style="width: 21.6pt; white-space: nowrap">
                <span class="bold">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="procStep_inner"><a name="933998">Verify that NetFlow data collection is configured according to the </a><span class="HTBlue"><a href="javascript:WWHClickedPopup('modules', 'al_module_netflow.05.08.html#933963', '');" title="Correcting Sampled NetFlow Data">Requirements</a></span> given earlier.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="procStep_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="procStep_inner" style="width: 21.6pt; white-space: nowrap">
                <span class="bold">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="procStep_inner"><a name="933999">Log into each NetFlow device that is sending sampled data and enter the following commands:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="procStepCont" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span class="code"><a name="934000">ip flow-cache timeout active 1<br />ip flow-export source Loopback0<br />ip flow-export version 9<br />ip flow-export template options sampler<br />ip flow-export template options refresh-rate 4</a></span></div>
      <div class="procNote">
        <span class="bold">Note—</span><a name="934001">The last command (“refresh-rate”) is optional, but recommended as a best practice for using NetFlow with AppResponse.</a></div>
      <div class="procStep_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="procStep_inner" style="width: 21.6pt; white-space: nowrap">
                <span class="bold">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="procStep_inner"><span class="italic"><a name="934005">(Optional)</a></span> Verify correct operation with the following commands. (Each command is followed by sample results, with pertinent parts in bold.)</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="procStepSubAltIntro"><a name="934006">To verify that the sampler maps are working as expected:</a></div>
      <div class="procStepCont" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span class="code"><a name="934007">Router# show flow-sampler<br /><br /></a></span><span class="codebold">Sampler : My_Sampler_50%, id : 2, packets matched : 132017785, mode : random sampling mode <br />&nbsp;&nbsp;sampling interval is : 2<br /></span><span class="code" style="font-weight: normal">Router#</span></div>
      <div class="procStepSubAltIntro"><a name="934008">To verify that a device is sending the optional sampler template required by AppResponse:</a></div>
      <div class="procStepCont" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline"><span class="code"><a name="934012">NAM-Router# show ip flow export template<br />&nbsp;&nbsp;&nbsp;Template Options Flag = 2<br />&nbsp;&nbsp;&nbsp;Total number of Templates added = 3<br />&nbsp;&nbsp;&nbsp;Total active Templates = 3<br />&nbsp;&nbsp;&nbsp;Flow Templates active = 2<br />&nbsp;&nbsp;&nbsp;Flow Templates added = 2<br />&nbsp;&nbsp;&nbsp;</a></span><span class="codebold">Option Templates active = 1<br /></span><span class="code" style="font-weight: normal">&nbsp;&nbsp;&nbsp;Option  Templates added = 1<br />&nbsp;&nbsp;&nbsp;Template ager polls = 25852838<br />&nbsp;&nbsp;&nbsp;Option Template ager polls = 12926440<br />Main cache version 9 export is enabled<br />Template export information<br />&nbsp;&nbsp;&nbsp;Template timeout = 30<br />&nbsp;&nbsp;&nbsp;Template refresh rate = 20<br /></span><span class="codebold">Option export information<br />&nbsp;&nbsp;&nbsp;Option timeout = 30<br />&nbsp;&nbsp;&nbsp;Option refresh rate = 4<br /></span><span class="code" style="font-weight: normal">NAM-Router#</span></div>
      <div class="procEnd_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="procEnd_inner" style="width: 32.4pt; white-space: nowrap">End of Procedure 6</div>
            </td>
            <td width="100%">
              <div class="procEnd_inner"><a name="934013">&nbsp;</a></div>
            </td>
          </tr>
        </table>
      </div>
      <script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVClose();</script>
      <div class="procSpaceAfter"><a name="934014">&nbsp;</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
    <div style="font-size: 8pt; font-family: arial; text-align: left; text-decoration: none;">
      <a href="../wwhelp/wwhimpl/common/html/default.htm">Home</a> | <a href="#" title="To the top of this page">Back to Top</a><br /><br />© 2014 Riverbed Technology.
  All Rights Reserved. This software may be covered by one or more U.S. Patents. See complete patent notice in the <a href="../Notices/ace_live_copy_info_wwp.html">Legal Notices</a> section. <br /><a href="http://www.riverbed.com/support/" style="text-decoration: none" target="_blank"> Riverbed Support</a><br /></div>
  </body>
</html>